<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Start html</title>
    <!-- Activate IE9 document mode, if available. -->
    <!-- If missing, the WebBrowser control on Windows runs in default IE8 mode which is not supported by JSBridge. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Defined iOS viewport -->
    <!-- If missing, the UIWebView control on iOS zooms out the web page and allows the pinch zoom. -->
    <meta
      name="viewport"
      content="initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
    />
    <script src="lib/JSBridge.js"></script>
    <script src="lib/polyfill.min.js"></script>
  </head>
  <body>
    <script>
      var dwEntryPoint = 'dw';
      var dwClassName;
      var scriptSrc;

      function showScriptLoadError(loadErr) {
        var errSrc =
          loadErr && loadErr.target ? loadErr.target.src : loadErr.toString();
        alert(
          'Error while loading the script >>>' +
            errSrc +
            '<<<\n' +
            loadErr.description
        );
      }
      function loadDwCustomScript() {
        if (window[dwEntryPoint]) {
          if (window[dwEntryPoint][dwClassName]) {
            window[dwEntryPoint][dwClassName].prototype.initialize();
          } else {
            alert(
              'Please ensure that the naming convention is followed! \nThe class [' +
                dwClassName +
                '] was not found in the file [' +
                scriptSrc +
                ']'
            );
          }
        } else {
          alert(
            'Script [' +
              scriptSrc +
              '] is loaded but the entry point [' +
              dwEntryPoint +
              '] was not found!'
          );
        }
      }
      function getCustomScriptName() {
        var targetUrl = window.location.href;
        var handlerName = 'handler';
        var regex = new RegExp('[?&]' + handlerName + '(=([^&#]*)|&|#|$)');
        var results = regex.exec(targetUrl);
        var scriptName;
        if (results && results.length > 0) {
          scriptName = results[2];
        }
        return scriptName;
      }
      function registerRescoMobileScriptEvents() {
        try {
          var customScriptName = getCustomScriptName();

          var customScriptUri = './dw/' + customScriptName + '.js';

          var dwFormNameParts;
          var dwFormName;
          var scriptElem = document.createElement('script');

          scriptElem.src = customScriptUri;
          scriptElem.onerror = showScriptLoadError.bind(this);

          if (customScriptUri) {
            scriptSrc = customScriptUri;
            dwFormName = customScriptName.substr(
              0,
              customScriptName.indexOf('.resco')
            );
            dwEntryPoint = dwEntryPoint + dwFormName;

            dwFormNameParts = dwFormName.split('_');
            if (dwFormNameParts.length > 1) {
              dwClassName =
                dwFormNameParts[0][0].toUpperCase() +
                dwFormNameParts[0].slice(1) +
                dwFormNameParts[1][0].toUpperCase() +
                dwFormNameParts[1].slice(1);
            } else {
              dwClassName =
                customScriptName[0].toUpperCase() + customScriptName.slice(1);
            }
          }
          scriptElem.onreadystatechange = loadDwCustomScript.bind(this);
          scriptElem.onload = loadDwCustomScript.bind(this);

          document.getElementsByTagName('head')[0].appendChild(scriptElem);
        } catch (e) {
          alert(
            'registerRescoMobileScriptEvents scriptError:\n' + JSON.stringify(e)
          );
        }
      }

      window.onload = function () {
        registerRescoMobileScriptEvents();
      };
    </script>
  </body>
</html>
